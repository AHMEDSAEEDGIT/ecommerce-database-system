# ðŸ’° popular-products-of-the-same-category-recommendations
##  Can you design a query to suggest popular products in the same category for the same author, excluding the Purchsed product from the recommendations
```sql
WITH MOST_POPULAR_PRODUCTS AS (
SELECT   OD.PRODUCT_ID,
		P.CATEGORY_ID,
        P.NAME ,
		SUM(OD.QUANTITY) TOTAL_QUANTITY
FROM ORDERS O
JOIN ORDER_DETAILS OD 
	ON O.ORDER_ID = OD.ORDER_ID
JOIN PRODUCT P 
	ON OD.PRODUCT_ID = P.PRODUCT_ID
GROUP BY  OD.PRODUCT_ID
ORDER BY TOTAL_QUANTITY DESC
LIMIT 10 ),
PURCHASED_PRODUCTS AS (
SELECT DISTINCT  O.CUSTOMER_ID , OD.PRODUCT_ID , P.CATEGORY_ID
FROM ORDERS O 
JOIN ORDER_DETAILS OD 
	ON O.ORDER_ID = OD.ORDER_ID
JOIN PRODUCT P 
	ON OD.PRODUCT_ID = P.PRODUCT_ID
)
```

---

```sql
SELECT * 
FROM PURCHASED_PRODUCTS PP
JOIN MOST_POPULAR_PRODUCTS MPP
	ON PP.CATEGORY_ID = MPP.CATEGORY_ID
    AND PP.PRODUCT_ID != MPP.PRODUCT_ID
WHERE NOT EXISTS(
    SELECT 1
    FROM PURCHASED_PRODUCTS PP2
    WHERE PP2.CUSTOMER_ID = PP.CUSTOMER_ID
      AND PP2.PRODUCT_ID = MPP.PRODUCT_ID
)
```







